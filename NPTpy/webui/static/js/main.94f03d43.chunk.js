(window["webpackJsonpreact-app"]=window["webpackJsonpreact-app"]||[]).push([[0],{42:function(e,t,n){e.exports=n(78)},50:function(e,t,n){},72:function(e,t,n){},73:function(e,t,n){},74:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);n(43),n(44),n(45);var r=n(0),a=n.n(r),l=n(17),o=n.n(l),c=n(15),i=n(8),s=n(9),u=n(11),m=n(10),v=n(19),d=n(12),p=(n(50),n(13)),f=n(16),b=n(14),h=n(21),w=n.n(h),g=Object({NODE_ENV:"production",PUBLIC_URL:"",REACT_APP_PORTAL:"true"}).REACT_APP_REMOTE?"http://192.168.11.11/api":"/api";function k(e){return e.then(function(e){return e.data?e.data:Promise.reject("No reply from server")})}function y(e,t){return k(w.a.post(g+e,t))}var E=200,O=1e3;function j(){window.clearInterval(window.intervalID),window.intervalID=0}function C(e){window.document.hidden||window.isOK===e&&window.intervalID||(window.isOK=e,j(),window.intervalID=window.setInterval(A,e?E:O))}function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}window.intervalID=0,window.isOK=!1,window.document.addEventListener("visibilitychange",function(){window.document.hidden?j():A()}),window.bootID=void 0,window.portalTime=void 0;var I=0,N=10,S=50;function P(e){window.rootComponent.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(n,!0).forEach(function(t){Object(f.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},window.rootComponent.state,{},e))}function L(e){if((I-=N)<0&&(I=0),e){if(window.bootID||(window.bootID=e.bootID),e.bootID!==window.bootID)throw Error("Out of sync, please refresh the page");window.portalTime=e.time,P({isLive:!0,store:e.store}),C(!0),b.b.dismiss(1)}}function A(){var e;I<S?(I+=N,(e="/",k(w.a.post(g+e,{}))).then(L).catch(function(e){P({isLive:!1}),C(!1),b.b.error("",{toastId:1}),b.b.update(1,{render:e.message,autoClose:!1})})):I-=1}function x(e){return P({saved:!1,saveOK:!0}),y("/",{bootID:window.bootID,time:window.portalTime,store:e}).then(L).catch(function(e){throw e.response&&400===e.response.status&&(b.b.warning(e.message),console.log(e.response.data)),e})}function R(){return P({saved:!0,saveOK:!1}),y("/",{bootID:window.bootID,time:window.portalTime,save:!0}).then(function(){return P({saved:!0,saveOK:!0})}).catch(function(e){b.b.error("Save failed: "+e.message),P({saved:!1,saveOK:!1})})}n(72),n(73);var T=function(e){var t=e.isLive,n=e.saved,r=e.saveOK,l=e.portalID,o=e.toggleLevel,c=e.onToggle;return a.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light"},a.a.createElement("i",{className:"fa clickable toggler L"+o,onClick:c}),a.a.createElement("a",{href:"/",className:"navbar-brand"},"NetPort"),a.a.createElement("div",{className:"collapse navbar-collapse"},a.a.createElement("div",{className:"navbar-nav"},a.a.createElement("span",{className:"nav-item nav-link"},"Portal [",l,"]"))),a.a.createElement("button",{className:"mx-3 btn "+(r?"btn-success":n?"":"btn-warning"),disabled:n,onClick:R},n?r?"Saved":"Saving":r?"Save":"Click to retry"),a.a.createElement("span",{className:"navbar-brand text-"+(t?"success":"warning")},a.a.createElement("i",{className:"mx-2 fa fa-"+(t?"check":"exclamation")}),t?"Live":"Offline"))};n(74);function K(e){return function(e){return e instanceof Array&&(!e.length||void 0!==e[0].k)}(e)?e:Object.keys(e).map(function(t){return{k:t,v:e[t]}})}var V=["collapse","toggled","","toggled"];function _(e){return e.map(function(e){return{k:e.v.otherID,v:e.v.otherID}})}function F(e,t){return t.length?t.map(function(t){var n=t.k,r=t.v;return a.a.createElement(c.c,{exact:!0,key:n,to:"/".concat(e,"/").concat(n)},r)}):a.a.createElement("span",{className:"disabled"},"No entries")}var B=function(e){var t=null,n=null,r=null;return t=K(e.links),n=_(t.filter(function(e){return e.v.isClient})),r=_(t.filter(function(e){return!e.v.isClient})),a.a.createElement(p.e.Consumer,null,function(t){return a.a.createElement("ul",{className:"sidebar navbar-nav "+V[e.toggleLevel]},a.a.createElement("li",null,a.a.createElement(c.c,{exact:!0,to:"/"},a.a.createElement("i",{className:"fa fa-home"}),"Home")),a.a.createElement("li",null,a.a.createElement(c.c,{to:"/links",className:"drops"},a.a.createElement("i",{className:"fa fa-plug"}),"Links"),a.a.createElement("div",{className:window.isLocationActive("/links")?"":"collapse"},a.a.createElement("span",null,"Permanent"),F("links",n),a.a.createElement("hr",null),a.a.createElement("span",null,"Temporary"),F("links",r))),null)})},U=function(e){function t(){var e;Object(i.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).state={toggleLevel:2},e.toggle=function(){var t=e.state;t.toggleLevel+=2,t.toggleLevel>3&&(t.toggleLevel=0),localStorage.toggleLevel=t.toggleLevel,e.setState(t)};var n=localStorage.toggleLevel;return n&&(e.state.toggleLevel=parseInt(n)),e}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.isLive,n=e.store,r=e.saved,l=e.saveOK,o=e.children,c=this.state.toggleLevel;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.a,{autoClose:5e3,position:"top-center"}),a.a.createElement(T,{isLive:t,saved:r,saveOK:l,portalID:n.portalID,toggleLevel:c,onToggle:this.toggle}),a.a.createElement("div",{className:"wrapper"},a.a.createElement(B,{links:n.links,toggleLevel:c}),a.a.createElement("main",{className:"container-fluid overflow-auto p-4"},o)))}}]),t}(r.Component);function H(e){return a.a.createElement("i",{className:"fa fa-"+(e?"check":"times")})}var J=n(40),M=n.n(J);function q(e,t){var n=[],r=[],l=!0,o=!1,c=void 0;try{for(var i,s=t[Symbol.iterator]();!(l=(i=s.next()).done);l=!0){var u=i.value,m=1,v=1;u.v.subColumns?(v=u.v.leafCount,r=r.concat(u.v.subColumns)):m=e,n.push(a.a.createElement("th",{key:u.k,rowSpan:m,colSpan:v},u.v.label))}}catch(d){o=!0,c=d}finally{try{l||null==s.return||s.return()}finally{if(o)throw c}}return{cells:n,queue:r}}var W=function(e){for(var t=e.columns,n=[],r=function e(t){var n=0,r=0,a=!0,l=!1,o=void 0;try{for(var c,i=t[Symbol.iterator]();!(a=(c=i.next()).done);a=!0){var s=c.value;if(s.v.subColumns){var u=e(s.v.subColumns),m=u.height,v=u.leafCount;s.v.leafCount=v,m>n&&(n=m),r+=v}else r+=1}}catch(d){l=!0,o=d}finally{try{a||null==i.return||i.return()}finally{if(l)throw o}}return{height:n+1,leafCount:r}}(t).height;r>0;r--){var l=q(r,t),o=l.cells,c=l.queue;n.push(a.a.createElement("tr",{key:r},o)),t=c}return a.a.createElement("thead",null,n)};function z(e){var t=e.k,n=(e.v,e.cells);return a.a.createElement("tr",{key:window.JSON.stringify(t)},n)}var G=function(e){var t=e.columns,n=e.data,r=e.rowRenderer;return r=r||z,a.a.createElement("tbody",null,n.length?n.map(function(e){var n=e.k,l=e.v;return r({k:n,v:l,cells:t.map(function(e){return a.a.createElement("td",{key:e.k},e.v.renderer({k:n,v:l}))})})}):a.a.createElement("tr",null,a.a.createElement("td",{colSpan:t.length},"No entries")))};var Q=function(e){var t=K(e.columns),n=K(e.data),r=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=[],a=!0,l=!1,o=void 0;try{for(var c,i=t[Symbol.iterator]();!(a=(c=i.next()).done);a=!0){var s=c.value;if(s.v._keyIsAbs||(s.v._keyIsAbs=!0,s.k=n+s.k),s.v.subColumns){s.v.subColumns=K(s.v.subColumns);var u=e(s.v.subColumns,s.k+"."),m=!0,v=!1,d=void 0;try{for(var p,f=u[Symbol.iterator]();!(m=(p=f.next()).done);m=!0){var b=p.value;r.push(b)}}catch(h){v=!0,d=h}finally{try{m||null==f.return||f.return()}finally{if(v)throw d}}}else r.push(s)}}catch(h){l=!0,o=h}finally{try{a||null==i.return||i.return()}finally{if(l)throw o}}return r}(t);return function(e){e.forEach(function(e){var t=e.v;t.renderer||(t.renderer=function(e){return M.a.get(e,t.path)})})}(r),a.a.createElement("table",{className:"table table-bordered "+e.className},a.a.createElement(W,{columns:t}),a.a.createElement(G,{columns:r,data:n,rowRenderer:e.rowRenderer}))};var X=function(e){var t=e.items,n=e.selectedKey,r=e.onSelect;return a.a.createElement("div",{className:"btn-group"},Object.keys(t).map(function(e){return a.a.createElement("button",{type:"button",onClick:function(){return r(e)},key:e,className:"btn "+t[e].className+(e===n?" active":"")},t[e].label)}))},Y=function(e){function t(){var e,n;Object(i.a)(this,t);for(var r=arguments.length,l=new Array(r),o=0;o<r;o++)l[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(l)))).state={ok:!0,visible:!1,selectedType:"perm"},n.inputOtherID=a.a.createRef(),n.selectType=function(e){n.setState({selectedType:e})},n.setVisible=function(e){n.setState({visible:e,ok:!0})},n.doSubmit=function(){n.setState({ok:!0}),x({createLink:{isClient:"perm"===n.state.selectedType,otherID:n.inputOtherID.current.value}}).then(function(){return n.setVisible(!1)}).catch(function(){return n.setState({ok:!1})})},n}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.ok,r=t.visible,l=t.selectedType;return a.a.createElement("div",{className:"p-md-2 text-center input-group"+(n?"":" bg-warning"),onChange:function(){return e.setState({ok:!0})}},r?a.a.createElement(a.a.Fragment,null,a.a.createElement(X,{items:{perm:{label:"Permanent",className:"btn-info"},temp:{label:"Temporary",className:"btn-info"}},selectedKey:l,onSelect:this.selectType}),a.a.createElement("input",{ref:this.inputOtherID,type:"text",className:"form-control",placeholder:"Remote portal ID"}),a.a.createElement("button",{className:"btn btn-success",onClick:function(){return e.doSubmit()}},"Confirm"),a.a.createElement("button",{className:"btn btn-danger",onClick:function(){return e.setVisible(!1)}},"\xd7")):a.a.createElement("button",{className:"btn btn-success",onClick:function(){return e.setVisible(!0)}},"Add new link"))}}]),t}(r.Component);var Z={myID:{path:"k"},otherID:{label:"Remote portal ID",path:"v.otherID",renderer:function(e){var t=e.v;return a.a.createElement("a",{href:"/links/".concat(t.otherID)},t.otherID)}},rt:{label:"Use for relay",subColumns:{addr:{label:"Address",path:"v.rtAddr"},port:{label:"Port",path:"v.rtPort"}}},lt:{label:"Use for local",subColumns:{addr:{label:"Address",path:"v.ltAddr"},port:{label:"Port",path:"v.ltPort"}}},listeners:{label:"Listeners",path:"v.listeners.length"},eps:{label:"Endpoints",path:"v.eps.length"},state:{label:"Current state",path:"v.state"},waitingSince:{label:"Waiting for (seconds)",path:"v.waitingSince",renderer:function(e){var t=e.v;return t.waitingSince?(window.portalTime-t.waitingSince).toFixed(3):"N/A"}},allowSelect:{label:"Allow select()",path:"v.allowSelect",renderer:function(e){return H(e.v.allowSelect)}},buffer:{label:"Buffer",path:"v.buffer",renderer:function(){return"Buffer"}},delete:{renderer:function(e){var t=e.k;return a.a.createElement("button",{onClick:function(){x({removeLink:{linkID:t}})},className:"btn btn-danger btn-sm"},"Delete")}}},$=function(e){function t(){var e,n;Object(i.a)(this,t);for(var r=arguments.length,a=new Array(r),l=0;l<r;l++)a[l]=arguments[l];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(a)))).state={selectedType:"all"},n.selectType=function(e){n.setState({selectedType:e})},n}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.state.selectedType,t=this.props.links||[],n="all"===e?t:t.filter(function(t){return t.v.isClient===("perm"===e)});return a.a.createElement("div",null,"Showing ",n.length," out of ",t.length," total links.",a.a.createElement(Y,null),a.a.createElement(Q,{columns:Z,data:n}))}}]),t}(r.Component),ee=n(41);var te=function(e){var t=e.className,n=Object(ee.a)(e,["className"]);return a.a.createElement("button",Object.assign({className:"btn btn-danger btn-sm "+t},n),"Delete")},ne=function(e){function t(){var e,n;Object(i.a)(this,t);for(var r=arguments.length,l=new Array(r),o=0;o<r;o++)l[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(l)))).state={ok:!0,visible:!1},n.inputRemotePort=a.a.createRef(),n.inputRemoteAddr=a.a.createRef(),n.inputLocalPort=a.a.createRef(),n.inputLocalAddr=a.a.createRef(),n.setVisible=function(e){n.setState({visible:e,ok:!0})},n.doSubmit=function(){n.setState({ok:!0});var e=parseInt(n.inputRemotePort.current.value),t=n.inputRemoteAddr.current.value,r=parseInt(n.inputLocalPort.current.value),a=n.inputLocalAddr.current.value;x({links:[{k:n.props.link.k,v:{addListener:{remotePort:e,remoteAddr:t,localPort:r,localAddr:a}}}]}).then(function(){return n.setVisible(!1)}).catch(function(){return n.setState({ok:!1})})},n}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.ok,r=t.visible;return a.a.createElement("div",{className:"p-md-2 text-center input-group"+(n?"":" bg-warning"),onChange:function(){return e.setState({ok:!0})}},r?a.a.createElement(a.a.Fragment,null,a.a.createElement("input",{ref:this.inputRemoteAddr,type:"text",className:"form-control",placeholder:"Remote address"}),a.a.createElement("input",{ref:this.inputRemotePort,type:"text",className:"form-control",placeholder:"Remote port"}),a.a.createElement("input",{ref:this.inputLocalAddr,type:"text",className:"form-control",placeholder:"Local address"}),a.a.createElement("input",{ref:this.inputLocalPort,type:"text",className:"form-control",placeholder:"Local port"}),a.a.createElement("button",{className:"btn btn-success",onClick:function(){return e.doSubmit()}},"Confirm"),a.a.createElement("button",{className:"btn btn-danger",onClick:function(){return e.setVisible(!1)}},"\xd7")):a.a.createElement("button",{className:"btn btn-success",onClick:function(){return e.setVisible(!0)}},"Add new listener"))}}]),t}(r.Component);function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var ae={myID:{path:"k"},remote:{label:"Remote",subColumns:{addr:{label:"Address",path:"v.remoteAddr"},port:{label:"Port",path:"v.remotePort"}}},listening:{label:"Listening",subColumns:{addr:{label:"Address",path:"v.localAddr",renderer:function(e){var t=e.v;return"0.0.0.0"===t.localAddr||"::"===t.localAddr?a.a.createElement("b",null,"Any"):t.localAddr}},port:{label:"Port",path:"v.localPort"}}},allowSelect:{label:"Allow select()",path:"v.allowSelect",renderer:function(e){return H(e.v.allowSelect)}},reserveID:{label:"Reserved channel ID",path:"v.reserveID",renderer:function(e){return e.v.reserveID}}};var le=function(e){var t=e.link,n=e.listeners,r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(n,!0).forEach(function(t){Object(f.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},ae,{delete:{renderer:function(e){var n=e.k;return a.a.createElement(te,{onClick:function(){x({links:[{k:t.k,v:{removeListener:{listenerID:n}}}]})}})}}});return a.a.createElement("div",null,a.a.createElement(ne,{link:t}),a.a.createElement(Q,{columns:r,data:n,sortColumn:{key:"listening.port",ascending:!0}}))};function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var ce={myID:{label:"Local ID",path:"k"},myIDF:{label:"Foreign ID",path:"v.myIDF"},allowSelect:{label:"Allow select()",path:"v.allowSelect",renderer:function(e){return H(e.v.allowSelect)}}};var ie=function(e){var t=e.link,n=e.eps,r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(n,!0).forEach(function(t){Object(f.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},ce,{delete:{renderer:function(e){var n=e.k;return n>0?a.a.createElement(te,{onClick:function(){x({links:[{k:t.k,v:{deleteChannel:{channelID:n}}}]})}}):null}}});return a.a.createElement(Q,{columns:r,data:n})};var se=function(e){var t=e.links,n=e.id;if(!t||!n)return null;var r,l=t.find(function(e){return e.v.otherID===n});if(!l)return r="No link to portal "+n,b.b.error(r),window.routerComponent.history.goBack(),null;var o=l.v,c=o.listeners,i=o.eps;return a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col"},a.a.createElement("h4",{className:"text-center"},"Showing link to portal ",n),a.a.createElement("h5",null,"Has ",c.length," listener",1===c.length?"":"s"),a.a.createElement("div",{className:"ml-4"},a.a.createElement(le,{link:l,listeners:c})),a.a.createElement("h5",null,"Has ",i.length," endpoint",1===i.length?"":"s"),a.a.createElement("div",{className:"ml-4"},a.a.createElement(ie,{link:l,eps:i}))))};var ue=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).state={isLive:!1,store:{links:[],tables:{tokenMap:[],recordMap:[]}},saved:!0,saveOK:!0},window.rootComponent=Object(v.a)(e),A(),e}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.state,t=e.isLive,n=e.store,r=e.saved,l=e.saveOK;return a.a.createElement(U,{isLive:t,store:n,saved:r,saveOK:l},a.a.createElement(p.d,null,a.a.createElement(p.b,{exact:!0,path:"/"}),a.a.createElement(p.b,{exact:!0,path:"/links",render:function(e){return a.a.createElement($,{links:n.links})}}),a.a.createElement(p.b,{exact:!0,path:"/links/:id",render:function(e){return a.a.createElement(se,{links:n.links,id:e.match.params.id})}}),a.a.createElement(p.a,{to:"/"})))}}]),t}(r.Component);window.routerComponent={history:{location:{},goBack:function(){}}},window.linkInterceptor=new c.b({}),window.interceptClick=function(e){"a"===e.target.tagName.toLowerCase()&&(window.linkInterceptor.props.to=e.target.pathname,window.linkInterceptor.handleClick(e,window.routerComponent.history))},window.document.addEventListener("click",window.interceptClick),window.isLocationActive=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(c.c)({to:e,exact:t}),r=n.props.children(window.routerComponent.history);return"active"===r.props.className},window.routerComponent=o.a.render(a.a.createElement(c.a,null,a.a.createElement(ue,null)),document.getElementById("root"))}},[[42,1,2]]]);
//# sourceMappingURL=main.94f03d43.chunk.js.map